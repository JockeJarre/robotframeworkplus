
*** Settings ***
Library    Chart
Library    Process
Test Template     Measure Sleep Time
Suite Teardown    Embed Bar Chart  Sleep Measurement [s]  x_axis=0   y_axis=1   outfile=outfile.svg
Force Tags    chart
Documentation   Parse the sleep time from console and collect the measured values for a chart diagram, the suite-teardown will embed the chart diagram to log-file.
	
*** Variables ***
${chart_title}      Sleep Measurement
${test_seq1}        Measured Time
${test_seq2}        Reference Time
${x_axis_label}     Latency [us]
		
*** Test Cases ***    
Measure Sleep 1     1
Measure Sleep 2     2
Measure Sleep 3     3
Measure Sleep 4     4
Measure Sleep 5     5
Measure Sleep 6     6
Measure Sleep 7     7


*** Keywords ***
Measure Sleep Time
        [Arguments]   ${sleep_time} 
	${column} =   Set Variable  ${sleep_time}
	${reference_value} =   Set Variable  ${sleep_time}
	
	${proc} =    Start Process  /bin/bash -c "time sleep ${sleep_time}"   shell=yes
	${result} =   Wait For Process    ${proc}    
        Process Should Be Stopped    ${proc}
	Should Be Equal As Integers   ${result.rc}   0  
        ${match}  ${realtime}  ${usertime}  ${systime} =    Should Match Regexp   ${result.stderr}   	[^\\d]+0m(\\d.\\d+)[^\\d]+0m(\\d.\\d+)[^\\d]+0m(\\d.\\d+)
	Add To Chart   ${test_seq2}  ${column}   ${realtime} 
	Add To Chart   ${test_seq1}  ${column}   ${reference_value}

	
